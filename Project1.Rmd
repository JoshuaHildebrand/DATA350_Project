---
title: "Project1"
output: html_document
date: "2025-10-02"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F)
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

```{r}
library(NHANES)
library(ggcorrplot)
library(ggplot2)
library(dplyr)
library(tidyverse)
```

# Draft Set of Questions

# 1. How does AlcoholDay compare between Married and Divorced marital status groups across Race3

```{r}
nhanes_5 <- NHANESraw |>
  filter(SurveyYr == "2011_12" & Age >= 20)|>
  mutate(MaritalStatus2 = case_when(
    MaritalStatus %in% c("NeverMarried", "Divorced") ~ "Not Married",
    MaritalStatus %in% c("Married") ~ "Married"),
    MaritalStatus2 = factor(MaritalStatus2, levels = c("Married", "Not Married")))|>
  mutate(LogAlc = log(AlcoholYear))|>
  filter(!is.na(MaritalStatus2), 
         !is.na(Race3),
         !is.na(LogAlc))|>
  select(MaritalStatus2, Race3, LogAlc, AlcoholYear)

ggplot(nhanes_5,aes(x = LogAlc, fill = MaritalStatus2)) +
  geom_density(alpha = 0.3) +
  facet_wrap(~Race3) + 
  labs(title = "Distribution of Estimated Number of Days Per Year Participants Drank
       Alcohol by Race and Marriage Status", 
       x = "Estimated Number of Days Drinking Per Year (log)", 
       y = "Density", fill = "Marital Status") +  
  theme(plot.title = element_text(size = 12))+
  theme_bw()
```
```{r}
# Calculate summary statistics
summary_stats<-nhanes_5 |>
  group_by(Race3, MaritalStatus2) |>
  summarise(
    mean_days = mean(AlcoholYear),
    median_days = median(AlcoholYear),
    se = sd(AlcoholYear) / sqrt(n()),
    LCI = mean_days - se,
    UCI = mean_days + se
  )

# Plot means with error bars
ggplot(summary_stats, aes(x = Race3, y = mean_days, fill = MaritalStatus2)) +
  geom_col(position = position_dodge(0.9), alpha = 0.7) +
  geom_errorbar(aes(ymin = LCI, ymax = UCI),
                position = position_dodge(0.8), width = 0.2) +
  geom_point(aes(y = median_days), 
             position = position_dodge(0.8), size = 2, color = "black") +
  labs(title = "Mean Alcohol Days (bars) vs Median (black dot)",
       subtitle = "Error bars show standard error",
       x = "Race", y = "Drinking Days per Year") +
  theme_bw()
```
```{r}
# Still working on this one, wanted to visualize marriage statistics by race to get more context for graphs 
pie<- nhanes_5|>
  count(Race3,MaritalStatus2, name = "count")
ggplot(data = pie, aes(x = "", y = count, fill = MaritalStatus2)) + 
    geom_bar(stat = "identity", position = position_fill()) +
    geom_text(aes(label = count), position = position_fill(vjust = 0.5)) +
    coord_polar(theta = "y") +
    facet_wrap(~ Race3)+ theme_bw()
```

# 2. What is the distribution of testosterone in the data set over age and how does it vary across BMI groups?

## Testosterone by Age Across BMI WHO Groups for Males

-   Testosterone variable is total testosterone in nanograms per deciliter for participants aged 6 years or older for the years 2011-2012.
-   Age is the age of the participant in 2011-2012, subjects who were 80 years or older were recorded as 80
-   BMI WHO is the body mass index as categorized by the World Health Organization as 12.0-18.4 (underweight), 18.5-24.9 (normal weight), 25-29.9 (overweight), and 30 plus (Obese).

```{r}
NHANES_t <- NHANESraw |>
  select('Testosterone', 'Age', 'Gender','BMI_WHO') |>
  mutate(BMI_WHO = case_when(
    BMI_WHO == '12.0_18.5' ~ 'Underweight',
    BMI_WHO == '18.5_to_24.9' ~ 'Normal Weight',
    BMI_WHO == '25.0_to_29.9' ~ 'Overweight',
    BMI_WHO == '30.0_plus' ~ 'Obese'
  ))

NHANES_t |>
  filter(Gender == 'male') |>
  drop_na(BMI_WHO)|>
  ggplot(aes(x = Age, y = Testosterone)) +
  geom_point(aes(col = BMI_WHO), size = 0.65)+
  facet_wrap(~BMI_WHO) +
  labs(title = 'Testosterone vs Age', y = 'Testosterone (ng/dL)',
       col = 'BMI WHO', caption = 'Source: NHANESraw dataset') + 
  theme_bw()
```

-   Since the distributions are not normal, robust statistics are appropriate for better understanding the distributions.
  - Median and interquartile range are used to accurately compare the spread of testosterone data by age group overtime.

## Median Testosterone by Age Across BMI WHO groups.

```{r}
NHANES_t2 <- NHANES_t |>
  filter(Gender == 'male')|>
  drop_na(BMI_WHO, Testosterone)|>
  mutate(age_group = case_when(
    Age <= 20 ~ '06-20',
    Age <= 40 ~ '21-40',
    Age <= 60 ~ '41-60',
    Age <= 80 ~ '61-80'
  ))|>
  group_by(age_group, BMI_WHO) |> 
  summarize(medT = median(Testosterone), Q1 = quantile(Testosterone, 0.25), Q3 = quantile(Testosterone, 0.75))

ggplot(NHANES_t2, aes(x = age_group, y = medT))+
  geom_bar(aes(fill = BMI_WHO), stat = 'identity', position = 'dodge') + 
  geom_errorbar(aes(ymin = Q1, ymax = Q3, group = BMI_WHO),
                position=position_dodge(0.9))+
  geom_point(aes(group = BMI_WHO), position = position_dodge(0.9))+
  labs(title = 'Testosterone vs Age Group',
       y = 'Median Testosterone', x = 'Age Group',fill = 'BMI WHO',
       caption = 'Source: NHANESraw Dataset, Error Bar: First Quartile, Median, Third Quartile') + 
  theme_bw()

```
- Age is grouped into approximately twenty year increments starting at the first age recorded for testosterone which is six years

# 3. How does poverty ratio relate to BMI and cholesterol levels across races?
```{r}
# Filter to adults in 2011_12 with complete data for variables of interest.
nhanes_clean <- NHANESraw |> 
  filter(SurveyYr == "2011_12", Age >= 18) |> 
  select(ID, Race1, Race3, Poverty, BMI, BPSysAve, BPDiaAve, TotChol, Age, Gender) |> 
  na.omit()
```
# Poverty vs BMI by Race
```{r}
# Race3 distribution
ggplot(nhanes_clean, aes(x = Poverty, y = BMI)) +
  geom_point(alpha = 0.5, aes(color = Race3), size = 0.6) +
  geom_smooth(se = TRUE, color = "black") +
  facet_wrap(~ Race3) +
  labs(
    title = "Relationship Between Poverty Ratio and BMI Across Race",
    x = "Poverty Ratio",
    y = "Body Mass Index (BMI)"
  ) 
```
# Poverty vs Cholesterol by Race
```{r}
# Race3 distribution
ggplot(nhanes_clean, aes(x = Race3, y = TotChol, color = Race3)) +
  geom_jitter(alpha = 0.3, width = 0.2, size = 0.6) +
  geom_boxplot(alpha = 0.4, outlier.shape = NA) +
  labs(
    title = "Total Cholesterol by Race and Poverty Ratio Groups",
    x = "Race Category",
    y = "Total Cholesterol (mmol/L)"
  )
```

# 4. To what extent is education associated with the age when participants first begin smoking or using marijuana regularly, and does this vary by gender?
```{r}
# Filtering data 
nhanes_clean2 <- NHANESraw |> 
  select(ID, Age, Gender, SmokeAge, AgeRegMarij, Education) |> 
  na.omit() |>
  mutate(
    SmokeAgeGroup = cut(SmokeAge, breaks=c(0,14,17,20,100), labels=c("<15","15-17","18-20","21+")),
    MarijAgeGroup = cut(AgeRegMarij, breaks=c(0,14,17,20,100), labels=c("<15","15-17","18-20","21+"),           include.lowest = TRUE)
  )

# Smoking vs Education
ggplot(nhanes_clean2, aes(x=Education, fill=SmokeAgeGroup)) +
  geom_bar(position="dodge") + facet_wrap(~Gender) +
  labs(title="Age Started Smoking by Education and Gender",
       x="Education Level", y="Number of Participants", fill="Age Group") + coord_flip()
```

# Marijuana vs Education faceted by Gender
```{r}
ggplot(nhanes_clean2, aes(x=Education, fill=MarijAgeGroup)) +
  geom_bar(position="dodge") + facet_wrap(~Gender) +
  labs(title="Age Started Marijuana Use by Education and Gender",
       x="Education Level", y="Number of Participants", fill="Age Group") + coord_flip()
```
