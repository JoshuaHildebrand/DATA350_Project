---
title: "Project1"
output: html_document
date: "2025-10-02"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F)
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

```{r}
library(NHANES)
library(ggcorrplot)
library(ggplot2)
library(dplyr)
library(tidyverse)
```

# Draft Set of Questions

# 1. How does AlcoholDay compare between Married and NeverMarried (Or any two MaritalStatus groups) across Race1

```{r}
library(NHANES)
library(dplyr)
library(ggplot2)
names(NHANES)
head(NHANES)

NHANES |>
  distinct(SurveyYr)
# Here are some graphs I made for the first question - I tested out different options for Race categories (Race1 compared to Race3) as well as the variable AlcoholYear
# I decided to filter all SurveyYr variables to 2011_12 because the Race3 variable does not have the year 2009_10
# Will test out other relationship factors, like

# This is a KDE graph for the relationship of MaritalStatus and AlcoholDay across Race1
ggplot(subset(NHANES, MaritalStatus %in% c("Married", "NeverMarried") & SurveyYr =="2011_12"),
aes(x = log(AlcoholDay), fill = MaritalStatus)) +
geom_density(alpha = 0.3) +
facet_wrap(~Race1) 
scale_fill_manual(values = c("red", "blue"))

# This is a KDE graph for the relationship of MaritalStatus and AlcoholYear across Race1
ggplot(subset(NHANES, MaritalStatus %in% c("Married", "NeverMarried") & SurveyYr =="2011_12"),
aes(x = log(AlcoholDay), fill = MaritalStatus)) +
geom_density(alpha = 0.3) +
facet_wrap(~Race3) 
scale_fill_manual(values = c("red", "blue"))

# This is a KDE graph for the relationship of MaritalStatus and AlcoholDay across Race3
ggplot(subset(NHANES, MaritalStatus %in% c("Married", "NeverMarried") & SurveyYr =="2011_12"),
aes(x = log(AlcoholYear), fill = MaritalStatus)) +
geom_density(alpha = 0.3) +
facet_wrap(~Race1) 
scale_fill_manual(values = c("red", "blue"))

# This is a KDE graph for the relationship of MaritalStatus and AlcoholYear across Race3
ggplot(subset(NHANES, MaritalStatus %in% c("Married", "NeverMarried") & SurveyYr =="2011_12"),
aes(x = log(AlcoholYear), fill = MaritalStatus)) +
geom_density(alpha = 0.3) +
facet_wrap(~Race3) 
scale_fill_manual(values = c("red", "blue"))
```

# This is still Question 1, except I filtered for the variables "Married" and "Divorced" - they seem to have no divorce data for Asian survey participants, though.

```{r}
# This is a KDE graph for the relationship of MaritalStatus and AlcoholDay across Race1
ggplot(subset(NHANES, MaritalStatus %in% c("Married", "Divorced") & SurveyYr =="2011_12"),
aes(x = log(AlcoholDay), fill = MaritalStatus)) +
geom_density(alpha = 0.3) +
facet_wrap(~Race1) 
scale_fill_manual(values = c("red", "blue"))

# This is a KDE graph for the relationship of MaritalStatus and AlcoholYear across Race1
ggplot(subset(NHANES, MaritalStatus %in% c("Married", "Divorced") & SurveyYr =="2011_12"),
aes(x = log(AlcoholDay), fill = MaritalStatus)) +
geom_density(alpha = 0.3) +
facet_wrap(~Race3) 
scale_fill_manual(values = c("red", "blue"))

# This is a KDE graph for the relationship of MaritalStatus and AlcoholDay across Race3
ggplot(subset(NHANES, MaritalStatus %in% c("Married", "Divorced") & SurveyYr =="2011_12"),
aes(x = log(AlcoholYear), fill = MaritalStatus)) +
geom_density(alpha = 0.3) +
facet_wrap(~Race1) 
scale_fill_manual(values = c("red", "blue"))

# This is a KDE graph for the relationship of MaritalStatus and AlcoholYear across Race3
ggplot(subset(NHANES, MaritalStatus %in% c("Married", "Divorced") & SurveyYr =="2011_12"),
aes(x = log(AlcoholYear), fill = MaritalStatus)) +
geom_density(alpha = 0.3) +
facet_wrap(~Race3) 
scale_fill_manual(values = c("red", "blue"))
```

# 2. What is the distribution of testosterone in the data set over age and how does it vary across BMI groups?

## Testosterone by Age Across BMI WHO Groups for Males

-   Testosterone variable is total testosterone in nanograms per deciliter for participants aged 6 years or older for the years 2011-2012.
-   Age is the age of the participant in 2011-2012, subjects who were 80 years or older were recorded as 80
-   BMI WHO is the body mass index as categorized by the World Health Organization as 12.0-18.4 (underweight), 18.5-24.9 (normal weight), 25-29.9 (overweight), and 30 plus (Obese).

```{r}
NHANES_t <- NHANESraw |>
  select('Testosterone', 'Age', 'Gender','BMI_WHO') |>
  mutate(BMI_WHO = case_when(
    BMI_WHO == '12.0_18.5' ~ 'Underweight',
    BMI_WHO == '18.5_to_24.9' ~ 'Normal Weight',
    BMI_WHO == '25.0_to_29.9' ~ 'Overweight',
    BMI_WHO == '30.0_plus' ~ 'Obese'
  ))

NHANES_t |>
  filter(Gender == 'male') |>
  drop_na(BMI_WHO)|>
  ggplot(aes(x = Age, y = Testosterone)) +
  geom_point(aes(col = BMI_WHO), size = 0.65)+
  facet_wrap(~BMI_WHO) +
  labs(title = 'Testosterone vs Age', y = 'Testosterone (ng/dL)',
       col = 'BMI WHO', caption = 'Source: NHANESraw dataset') + 
  theme_bw()
```

-   Since the distributions are not normal, robust statistics are appropriate for better understanding the distributions.

## Median Testosterone by Age Across BMI WHO groups.

```{r}
NHANES_t2 <- NHANES_t |>
  filter(Gender == 'male')|>
  drop_na(BMI_WHO, Testosterone)|>
  mutate(age_group = case_when(
    Age <= 20 ~ '06-20',
    Age <= 40 ~ '21-40',
    Age <= 60 ~ '41-60',
    Age <= 80 ~ '61-80'
  ))|>
  group_by(age_group, BMI_WHO) |> 
  summarize(medT = median(Testosterone), Q1 = quantile(Testosterone, 0.25), Q3 = quantile(Testosterone, 0.75))

ggplot(NHANES_t2, aes(x = age_group, y = medT))+
  geom_bar(aes(fill = BMI_WHO), stat = 'identity', position = 'dodge') + 
  geom_errorbar(aes(ymin = Q1, ymax = Q3, group = BMI_WHO),
                position=position_dodge(0.9))+
  geom_point(aes(group = BMI_WHO), position = position_dodge(0.9))+
  labs(title = 'Testosterone vs Age Group',
       y = 'Median Testosterone', x = 'Age Group',fill = 'BMI WHO',
       caption = 'Source: NHANESraw Dataset, Error Bar: First Quartile, Median, Third Quartile') + 
  theme_bw()

```
